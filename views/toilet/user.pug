extends ../layout

block content
  - var url = user.picture;
  .container.user-bg
    .row
      .col-lg-6.col-xs-6
        img.profile-img(src=url)
      .col-lg-6.col-xs-6
        a.btn.btn-danger.pull-right(href='/logout') Logout
      .col-lg-12.text-center.clear 
        h2 Hey #{user.nickname}!
        a.new-toilet.btn.btn-success(href='/user/new') NEW BATHROOM 
        br
        br
        #map(style="width:100%;height:400px;")
        .col-lg-8.col-lg-offset-2
          each toilet in toilets
            br
            #toilet.row.toilet-card
              .col-lg-12
                br
                h3= toilet.name 
                - var friends = toilet.rating
                case friends
                  when 0: p This toilet sucks
                  when 1: p.star ★
                  when 2: p.star ★ ★ 
                  when 3: p.star ★ ★ ★ 
                  when 4: p.star ★ ★ ★ ★ 
                  when 5: p.star ★ ★ ★ ★ ★ 
                  default: p No ratings
                h4= 'Reviewer: ' + toilet.who
                h4= 'Date: ' + moment(toilet.date).format('MMM D, YYYY')
                p5= 'Coordinates: ('
                | 
                span#lat(name='lat')= toilet.lat
                |, 
                span#long(name='long')= toilet.long
                | 
                p5= ')'
                br
                a.btn.btn-default.margin-bot(href='/user/' + toilet._id + '/edit') Edit 
                |  
                a.btn.btn-default.margin-bot(href='/user/' + toilet._id) Map 
                //- form.delete-but(action='/user/' + toilet._id + '/edit',method='post',enctype='application/x-www-form-urlencoded')
                //-   input(type='hidden',value='DELETE',name='_method')
                //-   button.btn.btn-danger(type='submit').
                //-       X
  script.
    function loadAll() {
      var map = new google.maps.Map(document.getElementById('map'), {
      });
      var me = new google.maps.Marker({
        map: map
      });

      var myArray = [];
      var lat, long
      var count = document.getElementsByName('lat').length
      var i = 0
      var toilets;
      for (i = 0; i < count-1; i++) {
        lat = document.getElementsByName('lat')[i].innerHTML;
        long = document.getElementsByName('long')[i].innerHTML;
        toilets = new google.maps.Marker({
          map: map,
          icon: 'http://maps.google.com/mapfiles/kml/shapes/toilets.png',
          position: {lat: parseFloat(lat), lng: parseFloat(long)}
        })
      }
      console.log(myArray)
      

      
      if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function (position) {
              var pos = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
              me.setPosition(pos);
              map.setCenter(pos);
              map.setZoom(15)
          });
      }
    }
  script(src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBhgil07aflQPZ-H8VhK4cIXgQndv4UfYk&callback=loadAll", async, defer)


          
